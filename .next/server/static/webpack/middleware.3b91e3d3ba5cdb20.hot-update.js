"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(middleware)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\n\nasync function middleware(req) {\n    const res = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n    const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__.createMiddlewareClient)({\n        req,\n        res\n    });\n    const { data: { session } } = await supabase.auth.getSession();\n    // Protect dashboard routes - TEMPORARILY DISABLED to fix redirect loop\n    // The issue is staff table query timing out or failing\n    // TODO: Re-enable after fixing the staff query performance\n    /*\r\n  if (req.nextUrl.pathname.startsWith('/dashboard')) {\r\n    if (!session) {\r\n      // Not logged in - redirect to login\r\n      return NextResponse.redirect(new URL('/login', req.url))\r\n    }\r\n    // User is authenticated - allow access\r\n    // Role filtering happens in dashboard layout\r\n  }\r\n  */ // Redirect to dashboard if already logged in and trying to access login\n    if (req.nextUrl.pathname === '/login' && session) {\n        try {\n            // Get user role to redirect appropriately\n            const { data: staff, error } = await supabase.from('staff').select('role').eq('auth_user_id', session.user.id).single();\n            if (error) {\n                console.error('Error fetching staff role in middleware:', error);\n                // Default to admin if staff query fails\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/dashboard/admin', req.url));\n            }\n            const roleRedirects = {\n                admin: '/dashboard/admin',\n                operations_manager: '/dashboard/operations',\n                warehouse_staff: '/dashboard/warehouse',\n                driver: '/dashboard/driver',\n                accountant: '/dashboard/accounts'\n            };\n            const redirectPath = staff?.role ? roleRedirects[staff.role] : '/dashboard/admin';\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL(redirectPath, req.url));\n        } catch (err) {\n            console.error('Failed to fetch staff role in middleware:', err);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/dashboard/admin', req.url));\n        }\n    }\n    return res;\n}\nconst config = {\n    matcher: [\n        '/dashboard/:path*',\n        '/login'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFzRTtBQUM1QjtBQUduQyxlQUFlRSxXQUFXQyxHQUFnQjtJQUMvQyxNQUFNQyxNQUFNSCxxREFBWUEsQ0FBQ0ksSUFBSTtJQUU3QixNQUFNQyxXQUFXTixxRkFBc0JBLENBQUM7UUFBRUc7UUFBS0M7SUFBSTtJQUVuRCxNQUFNLEVBQ0pHLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEVBQ2xCLEdBQUcsTUFBTUYsU0FBU0csSUFBSSxDQUFDQyxVQUFVO0lBRWxDLHVFQUF1RTtJQUN2RSx1REFBdUQ7SUFDdkQsMkRBQTJEO0lBQzNEOzs7Ozs7Ozs7RUFTQSxHQUVBLHdFQUF3RTtJQUN4RSxJQUFJUCxJQUFJUSxPQUFPLENBQUNDLFFBQVEsS0FBSyxZQUFZSixTQUFTO1FBQ2hELElBQUk7WUFDRiwwQ0FBMEM7WUFDMUMsTUFBTSxFQUFFRCxNQUFNTSxLQUFLLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1SLFNBQ2xDUyxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLFFBQ1BDLEVBQUUsQ0FBQyxnQkFBZ0JULFFBQVFVLElBQUksQ0FBQ0MsRUFBRSxFQUNsQ0MsTUFBTTtZQUVULElBQUlOLE9BQU87Z0JBQ1RPLFFBQVFQLEtBQUssQ0FBQyw0Q0FBNENBO2dCQUMxRCx3Q0FBd0M7Z0JBQ3hDLE9BQU9iLHFEQUFZQSxDQUFDcUIsUUFBUSxDQUFDLElBQUlDLElBQUksb0JBQW9CcEIsSUFBSXFCLEdBQUc7WUFDbEU7WUFFQSxNQUFNQyxnQkFBMkM7Z0JBQy9DQyxPQUFPO2dCQUNQQyxvQkFBb0I7Z0JBQ3BCQyxpQkFBaUI7Z0JBQ2pCQyxRQUFRO2dCQUNSQyxZQUFZO1lBQ2Q7WUFFQSxNQUFNQyxlQUFlbEIsT0FBT21CLE9BQU9QLGFBQWEsQ0FBQ1osTUFBTW1CLElBQUksQ0FBQyxHQUFHO1lBQy9ELE9BQU8vQixxREFBWUEsQ0FBQ3FCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJUSxjQUFjNUIsSUFBSXFCLEdBQUc7UUFDNUQsRUFBRSxPQUFPUyxLQUFLO1lBQ1paLFFBQVFQLEtBQUssQ0FBQyw2Q0FBNkNtQjtZQUMzRCxPQUFPaEMscURBQVlBLENBQUNxQixRQUFRLENBQUMsSUFBSUMsSUFBSSxvQkFBb0JwQixJQUFJcUIsR0FBRztRQUNsRTtJQUNGO0lBRUEsT0FBT3BCO0FBQ1Q7QUFFTyxNQUFNOEIsU0FBUztJQUNwQkMsU0FBUztRQUFDO1FBQXFCO0tBQVM7QUFDMUMsRUFBQyIsInNvdXJjZXMiOlsiRDpcXHJlYWN0IHByb2plY3RcXEVaU1RPUkFHRVxcbWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVNaWRkbGV3YXJlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL2F1dGgtaGVscGVycy1uZXh0anMnXHJcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xyXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXE6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgcmVzID0gTmV4dFJlc3BvbnNlLm5leHQoKVxyXG5cclxuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZU1pZGRsZXdhcmVDbGllbnQoeyByZXEsIHJlcyB9KVxyXG5cclxuICBjb25zdCB7XHJcbiAgICBkYXRhOiB7IHNlc3Npb24gfSxcclxuICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKClcclxuXHJcbiAgLy8gUHJvdGVjdCBkYXNoYm9hcmQgcm91dGVzIC0gVEVNUE9SQVJJTFkgRElTQUJMRUQgdG8gZml4IHJlZGlyZWN0IGxvb3BcclxuICAvLyBUaGUgaXNzdWUgaXMgc3RhZmYgdGFibGUgcXVlcnkgdGltaW5nIG91dCBvciBmYWlsaW5nXHJcbiAgLy8gVE9ETzogUmUtZW5hYmxlIGFmdGVyIGZpeGluZyB0aGUgc3RhZmYgcXVlcnkgcGVyZm9ybWFuY2VcclxuICAvKlxyXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvZGFzaGJvYXJkJykpIHtcclxuICAgIGlmICghc2Vzc2lvbikge1xyXG4gICAgICAvLyBOb3QgbG9nZ2VkIGluIC0gcmVkaXJlY3QgdG8gbG9naW5cclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXEudXJsKSlcclxuICAgIH1cclxuICAgIC8vIFVzZXIgaXMgYXV0aGVudGljYXRlZCAtIGFsbG93IGFjY2Vzc1xyXG4gICAgLy8gUm9sZSBmaWx0ZXJpbmcgaGFwcGVucyBpbiBkYXNoYm9hcmQgbGF5b3V0XHJcbiAgfVxyXG4gICovXHJcblxyXG4gIC8vIFJlZGlyZWN0IHRvIGRhc2hib2FyZCBpZiBhbHJlYWR5IGxvZ2dlZCBpbiBhbmQgdHJ5aW5nIHRvIGFjY2VzcyBsb2dpblxyXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZSA9PT0gJy9sb2dpbicgJiYgc2Vzc2lvbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gR2V0IHVzZXIgcm9sZSB0byByZWRpcmVjdCBhcHByb3ByaWF0ZWx5XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogc3RhZmYsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdzdGFmZicpXHJcbiAgICAgICAgLnNlbGVjdCgncm9sZScpXHJcbiAgICAgICAgLmVxKCdhdXRoX3VzZXJfaWQnLCBzZXNzaW9uLnVzZXIuaWQpXHJcbiAgICAgICAgLnNpbmdsZSgpXHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdGFmZiByb2xlIGluIG1pZGRsZXdhcmU6JywgZXJyb3IpXHJcbiAgICAgICAgLy8gRGVmYXVsdCB0byBhZG1pbiBpZiBzdGFmZiBxdWVyeSBmYWlsc1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2Rhc2hib2FyZC9hZG1pbicsIHJlcS51cmwpKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByb2xlUmVkaXJlY3RzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xyXG4gICAgICAgIGFkbWluOiAnL2Rhc2hib2FyZC9hZG1pbicsXHJcbiAgICAgICAgb3BlcmF0aW9uc19tYW5hZ2VyOiAnL2Rhc2hib2FyZC9vcGVyYXRpb25zJyxcclxuICAgICAgICB3YXJlaG91c2Vfc3RhZmY6ICcvZGFzaGJvYXJkL3dhcmVob3VzZScsXHJcbiAgICAgICAgZHJpdmVyOiAnL2Rhc2hib2FyZC9kcml2ZXInLFxyXG4gICAgICAgIGFjY291bnRhbnQ6ICcvZGFzaGJvYXJkL2FjY291bnRzJyxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVkaXJlY3RQYXRoID0gc3RhZmY/LnJvbGUgPyByb2xlUmVkaXJlY3RzW3N0YWZmLnJvbGVdIDogJy9kYXNoYm9hcmQvYWRtaW4nXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChyZWRpcmVjdFBhdGgsIHJlcS51cmwpKVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBzdGFmZiByb2xlIGluIG1pZGRsZXdhcmU6JywgZXJyKVxyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9kYXNoYm9hcmQvYWRtaW4nLCByZXEudXJsKSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiByZXNcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBtYXRjaGVyOiBbJy9kYXNoYm9hcmQvOnBhdGgqJywgJy9sb2dpbiddLFxyXG59XHJcbiJdLCJuYW1lcyI6WyJjcmVhdGVNaWRkbGV3YXJlQ2xpZW50IiwiTmV4dFJlc3BvbnNlIiwibWlkZGxld2FyZSIsInJlcSIsInJlcyIsIm5leHQiLCJzdXBhYmFzZSIsImRhdGEiLCJzZXNzaW9uIiwiYXV0aCIsImdldFNlc3Npb24iLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJzdGFmZiIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwidXNlciIsImlkIiwic2luZ2xlIiwiY29uc29sZSIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwicm9sZVJlZGlyZWN0cyIsImFkbWluIiwib3BlcmF0aW9uc19tYW5hZ2VyIiwid2FyZWhvdXNlX3N0YWZmIiwiZHJpdmVyIiwiYWNjb3VudGFudCIsInJlZGlyZWN0UGF0aCIsInJvbGUiLCJlcnIiLCJjb25maWciLCJtYXRjaGVyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});