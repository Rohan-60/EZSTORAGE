"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(middleware)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\n\nasync function middleware(req) {\n    const res = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n    const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_0__.createMiddlewareClient)({\n        req,\n        res\n    });\n    const { data: { session } } = await supabase.auth.getSession();\n    // Protect dashboard routes\n    if (req.nextUrl.pathname.startsWith('/dashboard')) {\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/login', req.url));\n        }\n    }\n    // Redirect to dashboard if already logged in and trying to access login\n    if (req.nextUrl.pathname === '/login' && session) {\n        try {\n            // Get user role to redirect appropriately\n            const { data: staff, error } = await supabase.from('staff').select('role').eq('auth_user_id', session.user.id).single();\n            if (error) {\n                console.error('Error fetching staff role in middleware:', error);\n                // Default to admin if staff query fails\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/dashboard/admin', req.url));\n            }\n            const roleRedirects = {\n                admin: '/dashboard/admin',\n                operations_manager: '/dashboard/operations',\n                warehouse_staff: '/dashboard/warehouse',\n                driver: '/dashboard/driver',\n                accountant: '/dashboard/accounts'\n            };\n            const redirectPath = staff?.role ? roleRedirects[staff.role] : '/dashboard/admin';\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL(redirectPath, req.url));\n        } catch (err) {\n            console.error('Failed to fetch staff role in middleware:', err);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/dashboard/admin', req.url));\n        }\n    }\n    return res;\n}\nconst config = {\n    matcher: [\n        '/dashboard/:path*',\n        '/login'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFzRTtBQUM1QjtBQUduQyxlQUFlRSxXQUFXQyxHQUFnQjtJQUMvQyxNQUFNQyxNQUFNSCxxREFBWUEsQ0FBQ0ksSUFBSTtJQUU3QixNQUFNQyxXQUFXTixxRkFBc0JBLENBQUM7UUFBRUc7UUFBS0M7SUFBSTtJQUVuRCxNQUFNLEVBQ0pHLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEVBQ2xCLEdBQUcsTUFBTUYsU0FBU0csSUFBSSxDQUFDQyxVQUFVO0lBRWxDLDJCQUEyQjtJQUMzQixJQUFJUCxJQUFJUSxPQUFPLENBQUNDLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDLGVBQWU7UUFDakQsSUFBSSxDQUFDTCxTQUFTO1lBQ1osT0FBT1AscURBQVlBLENBQUNhLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLFVBQVVaLElBQUlhLEdBQUc7UUFDeEQ7SUFDRjtJQUVBLHdFQUF3RTtJQUN4RSxJQUFJYixJQUFJUSxPQUFPLENBQUNDLFFBQVEsS0FBSyxZQUFZSixTQUFTO1FBQ2hELElBQUk7WUFDRiwwQ0FBMEM7WUFDMUMsTUFBTSxFQUFFRCxNQUFNVSxLQUFLLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1aLFNBQ2xDYSxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLFFBQ1BDLEVBQUUsQ0FBQyxnQkFBZ0JiLFFBQVFjLElBQUksQ0FBQ0MsRUFBRSxFQUNsQ0MsTUFBTTtZQUVULElBQUlOLE9BQU87Z0JBQ1RPLFFBQVFQLEtBQUssQ0FBQyw0Q0FBNENBO2dCQUMxRCx3Q0FBd0M7Z0JBQ3hDLE9BQU9qQixxREFBWUEsQ0FBQ2EsUUFBUSxDQUFDLElBQUlDLElBQUksb0JBQW9CWixJQUFJYSxHQUFHO1lBQ2xFO1lBRUEsTUFBTVUsZ0JBQTJDO2dCQUMvQ0MsT0FBTztnQkFDUEMsb0JBQW9CO2dCQUNwQkMsaUJBQWlCO2dCQUNqQkMsUUFBUTtnQkFDUkMsWUFBWTtZQUNkO1lBRUEsTUFBTUMsZUFBZWYsT0FBT2dCLE9BQU9QLGFBQWEsQ0FBQ1QsTUFBTWdCLElBQUksQ0FBQyxHQUFHO1lBQy9ELE9BQU9oQyxxREFBWUEsQ0FBQ2EsUUFBUSxDQUFDLElBQUlDLElBQUlpQixjQUFjN0IsSUFBSWEsR0FBRztRQUM1RCxFQUFFLE9BQU9rQixLQUFLO1lBQ1pULFFBQVFQLEtBQUssQ0FBQyw2Q0FBNkNnQjtZQUMzRCxPQUFPakMscURBQVlBLENBQUNhLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLG9CQUFvQlosSUFBSWEsR0FBRztRQUNsRTtJQUNGO0lBRUEsT0FBT1o7QUFDVDtBQUVPLE1BQU0rQixTQUFTO0lBQ3BCQyxTQUFTO1FBQUM7UUFBcUI7S0FBUztBQUMxQyxFQUFDIiwic291cmNlcyI6WyJEOlxccmVhY3QgcHJvamVjdFxcRVpTVE9SQUdFXFxtaWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZU1pZGRsZXdhcmVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2UvYXV0aC1oZWxwZXJzLW5leHRqcydcclxuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXHJcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcidcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCByZXMgPSBOZXh0UmVzcG9uc2UubmV4dCgpXHJcblxyXG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlTWlkZGxld2FyZUNsaWVudCh7IHJlcSwgcmVzIH0pXHJcblxyXG4gIGNvbnN0IHtcclxuICAgIGRhdGE6IHsgc2Vzc2lvbiB9LFxyXG4gIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKVxyXG5cclxuICAvLyBQcm90ZWN0IGRhc2hib2FyZCByb3V0ZXNcclxuICBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL2Rhc2hib2FyZCcpKSB7XHJcbiAgICBpZiAoIXNlc3Npb24pIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXEudXJsKSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFJlZGlyZWN0IHRvIGRhc2hib2FyZCBpZiBhbHJlYWR5IGxvZ2dlZCBpbiBhbmQgdHJ5aW5nIHRvIGFjY2VzcyBsb2dpblxyXG4gIGlmIChyZXEubmV4dFVybC5wYXRobmFtZSA9PT0gJy9sb2dpbicgJiYgc2Vzc2lvbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gR2V0IHVzZXIgcm9sZSB0byByZWRpcmVjdCBhcHByb3ByaWF0ZWx5XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogc3RhZmYsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdzdGFmZicpXHJcbiAgICAgICAgLnNlbGVjdCgncm9sZScpXHJcbiAgICAgICAgLmVxKCdhdXRoX3VzZXJfaWQnLCBzZXNzaW9uLnVzZXIuaWQpXHJcbiAgICAgICAgLnNpbmdsZSgpXHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdGFmZiByb2xlIGluIG1pZGRsZXdhcmU6JywgZXJyb3IpXHJcbiAgICAgICAgLy8gRGVmYXVsdCB0byBhZG1pbiBpZiBzdGFmZiBxdWVyeSBmYWlsc1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2Rhc2hib2FyZC9hZG1pbicsIHJlcS51cmwpKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByb2xlUmVkaXJlY3RzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xyXG4gICAgICAgIGFkbWluOiAnL2Rhc2hib2FyZC9hZG1pbicsXHJcbiAgICAgICAgb3BlcmF0aW9uc19tYW5hZ2VyOiAnL2Rhc2hib2FyZC9vcGVyYXRpb25zJyxcclxuICAgICAgICB3YXJlaG91c2Vfc3RhZmY6ICcvZGFzaGJvYXJkL3dhcmVob3VzZScsXHJcbiAgICAgICAgZHJpdmVyOiAnL2Rhc2hib2FyZC9kcml2ZXInLFxyXG4gICAgICAgIGFjY291bnRhbnQ6ICcvZGFzaGJvYXJkL2FjY291bnRzJyxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVkaXJlY3RQYXRoID0gc3RhZmY/LnJvbGUgPyByb2xlUmVkaXJlY3RzW3N0YWZmLnJvbGVdIDogJy9kYXNoYm9hcmQvYWRtaW4nXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChyZWRpcmVjdFBhdGgsIHJlcS51cmwpKVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBzdGFmZiByb2xlIGluIG1pZGRsZXdhcmU6JywgZXJyKVxyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9kYXNoYm9hcmQvYWRtaW4nLCByZXEudXJsKSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiByZXNcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBtYXRjaGVyOiBbJy9kYXNoYm9hcmQvOnBhdGgqJywgJy9sb2dpbiddLFxyXG59XHJcbiJdLCJuYW1lcyI6WyJjcmVhdGVNaWRkbGV3YXJlQ2xpZW50IiwiTmV4dFJlc3BvbnNlIiwibWlkZGxld2FyZSIsInJlcSIsInJlcyIsIm5leHQiLCJzdXBhYmFzZSIsImRhdGEiLCJzZXNzaW9uIiwiYXV0aCIsImdldFNlc3Npb24iLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJzdGFydHNXaXRoIiwicmVkaXJlY3QiLCJVUkwiLCJ1cmwiLCJzdGFmZiIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwidXNlciIsImlkIiwic2luZ2xlIiwiY29uc29sZSIsInJvbGVSZWRpcmVjdHMiLCJhZG1pbiIsIm9wZXJhdGlvbnNfbWFuYWdlciIsIndhcmVob3VzZV9zdGFmZiIsImRyaXZlciIsImFjY291bnRhbnQiLCJyZWRpcmVjdFBhdGgiLCJyb2xlIiwiZXJyIiwiY29uZmlnIiwibWF0Y2hlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});